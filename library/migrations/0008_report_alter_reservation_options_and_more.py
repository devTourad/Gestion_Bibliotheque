# Generated by Django 5.1.4 on 2025-06-12 15:07

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('library', '0007_payment_due_date_payment_loan_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='Report',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200, verbose_name='Titre du rapport')),
                ('report_type', models.CharField(choices=[('loans', 'Rapport des emprunts'), ('reservations', 'Rapport des réservations'), ('purchases', 'Rapport des achats'), ('payments', 'Rapport des paiements'), ('users', 'Rapport des utilisateurs'), ('books', 'Rapport des livres'), ('overdue', 'Rapport des retards'), ('statistics', 'Rapport statistiques'), ('financial', 'Rapport financier'), ('inventory', "Rapport d'inventaire")], max_length=20, verbose_name='Type de rapport')),
                ('format', models.CharField(choices=[('pdf', 'PDF'), ('excel', 'Excel (XLSX)'), ('csv', 'CSV'), ('json', 'JSON')], default='pdf', max_length=10, verbose_name='Format')),
                ('status', models.CharField(choices=[('pending', 'En attente'), ('generating', 'En cours de génération'), ('completed', 'Terminé'), ('failed', 'Échoué'), ('expired', 'Expiré')], default='pending', max_length=15, verbose_name='Statut')),
                ('date_from', models.DateField(blank=True, null=True, verbose_name='Date de début')),
                ('date_to', models.DateField(blank=True, null=True, verbose_name='Date de fin')),
                ('user_category', models.CharField(blank=True, max_length=20, verbose_name="Catégorie d'utilisateur")),
                ('include_details', models.BooleanField(default=True, verbose_name='Inclure les détails')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('generated_at', models.DateTimeField(blank=True, null=True, verbose_name='Date de génération')),
                ('expires_at', models.DateTimeField(blank=True, null=True, verbose_name="Date d'expiration")),
                ('file', models.FileField(blank=True, null=True, upload_to='reports/', verbose_name='Fichier du rapport')),
                ('file_size', models.PositiveIntegerField(blank=True, null=True, verbose_name='Taille du fichier (bytes)')),
                ('total_records', models.PositiveIntegerField(blank=True, null=True, verbose_name="Nombre total d'enregistrements")),
                ('generation_time', models.DurationField(blank=True, null=True, verbose_name='Temps de génération')),
                ('download_count', models.PositiveIntegerField(default=0, verbose_name='Nombre de téléchargements')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('error_message', models.TextField(blank=True, verbose_name="Message d'erreur")),
            ],
            options={
                'verbose_name': 'Rapport',
                'verbose_name_plural': 'Rapports',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AlterModelOptions(
            name='reservation',
            options={'ordering': ['priority', 'reservation_date'], 'verbose_name': 'Réservation', 'verbose_name_plural': 'Réservations'},
        ),
        migrations.AlterUniqueTogether(
            name='reservation',
            unique_together=set(),
        ),
        migrations.AddField(
            model_name='reservation',
            name='notes',
            field=models.TextField(blank=True, verbose_name='Notes'),
        ),
        migrations.AddField(
            model_name='reservation',
            name='priority',
            field=models.IntegerField(default=0, verbose_name='Priorité'),
        ),
        migrations.AddField(
            model_name='reservation',
            name='ready_date',
            field=models.DateTimeField(blank=True, null=True, verbose_name='Date de disponibilité'),
        ),
        migrations.AlterField(
            model_name='reservation',
            name='status',
            field=models.CharField(choices=[('active', 'En attente'), ('ready', 'Prête'), ('fulfilled', 'Satisfaite'), ('cancelled', 'Annulée'), ('expired', 'Expirée')], default='active', max_length=10, verbose_name='Statut'),
        ),
        migrations.AddConstraint(
            model_name='reservation',
            constraint=models.UniqueConstraint(condition=models.Q(('status__in', ['active', 'ready'])), fields=('user', 'book'), name='unique_active_reservation_per_user_book'),
        ),
        migrations.AddField(
            model_name='report',
            name='book_genre',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='library.genre', verbose_name='Genre de livre'),
        ),
        migrations.AddField(
            model_name='report',
            name='created_by',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='created_reports', to=settings.AUTH_USER_MODEL, verbose_name='Créé par'),
        ),
    ]
